# Clean Medusa Backend - Argo Workflow Based
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  # Step 1: Core Infrastructure
  - medusa-backend-namespace.yaml
  - medusa-backend-rbac.yaml

  # Step 2: Storage for Build Artifacts
  - medusa-backend-pvc.yaml

  # Step 3: Secrets
  - medusa-backend-infisical-secrets.yaml

  # Step 4: Database Dependencies
  - medusa-backend-postgresql.yaml
  - medusa-backend-redis.yaml

  # Step 5: Argo Workflow for Build and Deploy
  - medusa-backend-workflow-template.yaml

  # Step 6: External Access
  - medusa-backend-ingress.yaml

commonLabels:
  app.kubernetes.io/name: medusa-backend
  app.kubernetes.io/part-of: medusa-cluster