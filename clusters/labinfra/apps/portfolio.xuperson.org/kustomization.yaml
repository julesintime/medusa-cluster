---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: portfolio

resources:
  - portfolio-namespace.yaml
  - portfolio-infisical-secrets.yaml
  - portfolio-registry-secret.yaml
  - portfolio-imagerepository.yaml
  - portfolio-helmrelease.yaml
  - portfolio-ingress.yaml
  - portfolio-service.yaml

commonLabels:
  app.kubernetes.io/name: portfolio
  app.kubernetes.io/part-of: portfolio-wordpress
  app.kubernetes.io/managed-by: flux

# Resource ordering to ensure dependencies
patches:
  - target:
      kind: HelmRelease
      name: portfolio-wordpress
    patch: |-
      - op: add
        path: /metadata/annotations
        value:
          kustomize.toolkit.fluxcd.io/depends-on: "portfolio/portfolio-registry-credentials,portfolio/portfolio-secrets"