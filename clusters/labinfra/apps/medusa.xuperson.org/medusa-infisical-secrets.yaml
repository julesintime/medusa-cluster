apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: medusa-secrets
  namespace: medusa
spec:
  hostAPI: https://app.infisical.com/api
  resyncInterval: 60
  
  authentication:
    serviceToken:
      secretsScope:
        envSlug: prod
        secretsPath: "/"
        recursive: false
      serviceTokenSecretReference:
        secretName: infisical-service-token
        secretNamespace: infisical-operator
  
  managedKubeSecretReferences:
    - secretName: medusa-backend-secrets
      secretNamespace: medusa
      creationPolicy: "Orphan"
      template:
        data:
          jwt-secret: "{{ .JWT_SECRET.Value }}"
          cookie-secret: "{{ .COOKIE_SECRET.Value }}"
          database-url: "{{ .DATABASE_URL.Value }}"
          admin-email: "{{ .ADMIN_EMAIL.Value }}"
          admin-password: "{{ .ADMIN_PASSWORD.Value }}"
          store-cors: "{{ .STORE_CORS.Value }}"
          admin-cors: "{{ .ADMIN_CORS.Value }}"
    
    - secretName: medusa-postgres-secrets
      secretNamespace: medusa
      creationPolicy: "Orphan"
      template:
        data:
          postgres-password: "{{ .POSTGRES_PASSWORD.Value }}"
    
    - secretName: medusa-storefront-secrets
      secretNamespace: medusa
      creationPolicy: "Orphan"
      template:
        data:
          next-public-medusa-publishable-key: "{{ .NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY.Value }}"
          next-public-default-region: "{{ .NEXT_PUBLIC_DEFAULT_REGION.Value }}"
          next-public-base-url: "{{ .NEXT_PUBLIC_BASE_URL.Value }}"