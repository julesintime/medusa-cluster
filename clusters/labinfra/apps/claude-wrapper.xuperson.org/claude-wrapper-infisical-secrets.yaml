apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: claude-wrapper-secrets
  namespace: claude-wrapper
spec:
  hostAPI: https://app.infisical.com/api
  resyncInterval: 60
  
  authentication:
    serviceToken:
      secretsScope:
        envSlug: prod
        secretsPath: "/"
        recursive: false
      serviceTokenSecretReference:
        secretName: infisical-service-token
        secretNamespace: infisical-operator  # Shared service token
  
  managedKubeSecretReferences:
    - secretName: claude-wrapper-auth
      secretNamespace: claude-wrapper
      creationPolicy: "Orphan"
      template:
        data:
          # Claude Code authentication options
          anthropic-api-key: "{{ .CLAUDE_WRAPPER_ANTHROPIC_API_KEY.Value | default \"\" }}"
          
          # OAuth authentication (JSON file content)
          claude-oauth-config: "{{ .CLAUDE_WRAPPER_CLAUDE_OAUTH_CONFIG.Value | default \"{}\" }}"
          
          # AWS Bedrock authentication
          claude-use-bedrock: "{{ .CLAUDE_WRAPPER_CLAUDE_CODE_USE_BEDROCK.Value | default \"0\" }}"
          aws-access-key-id: "{{ .CLAUDE_WRAPPER_AWS_ACCESS_KEY_ID.Value | default \"\" }}"
          aws-secret-access-key: "{{ .CLAUDE_WRAPPER_AWS_SECRET_ACCESS_KEY.Value | default \"\" }}"
          aws-region: "{{ .CLAUDE_WRAPPER_AWS_REGION.Value | default \"\" }}"
          
          # Vertex AI authentication
          claude-use-vertex: "{{ .CLAUDE_WRAPPER_CLAUDE_CODE_USE_VERTEX.Value | default \"0\" }}"
          anthropic-vertex-project-id: "{{ .CLAUDE_WRAPPER_ANTHROPIC_VERTEX_PROJECT_ID.Value | default \"\" }}"
          cloud-ml-region: "{{ .CLAUDE_WRAPPER_CLOUD_ML_REGION.Value | default \"\" }}"
          google-application-credentials: "{{ .CLAUDE_WRAPPER_GOOGLE_APPLICATION_CREDENTIALS.Value | default \"\" }}"
          
          # Optional API key protection for the wrapper endpoints
          api-key: "{{ .CLAUDE_WRAPPER_API_KEY.Value | default \"\" }}"
          
          # Additional configuration
          max-timeout: "{{ .CLAUDE_WRAPPER_MAX_TIMEOUT.Value | default \"600000\" }}"
          cors-origins: "{{ .CLAUDE_WRAPPER_CORS_ORIGINS.Value | default \"[\\\"*\\\"]\" }}"