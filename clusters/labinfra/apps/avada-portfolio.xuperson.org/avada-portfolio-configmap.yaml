---
apiVersion: v1
kind: ConfigMap
metadata:
  name: wordpress-config
  namespace: avada-portfolio
  labels:
    app.kubernetes.io/name: avada-portfolio
    app.kubernetes.io/component: wordpress
data:
  php.ini: |
    upload_max_filesize = 128M
    post_max_size = 128M
    max_execution_time = 300
    max_input_vars = 3000
    memory_limit = 256M

  wp-config-custom.php: |
    <?php
    // WordPress Database Configuration
    define('DB_NAME', getenv('WORDPRESS_DB_NAME'));
    define('DB_USER', getenv('WORDPRESS_DB_USER'));
    define('DB_PASSWORD', getenv('WORDPRESS_DB_PASSWORD'));
    define('DB_HOST', getenv('WORDPRESS_DB_HOST'));
    define('DB_CHARSET', 'utf8mb4');
    define('DB_COLLATE', '');

    // WordPress Security Keys from Infisical
    define('AUTH_KEY', getenv('WP_AUTH_KEY'));
    define('SECURE_AUTH_KEY', getenv('WP_SECURE_AUTH_KEY'));
    define('LOGGED_IN_KEY', getenv('WP_LOGGED_IN_KEY'));
    define('NONCE_KEY', getenv('WP_NONCE_KEY'));

    // WordPress Debug Configuration
    define('WP_DEBUG', false);
    define('WP_DEBUG_LOG', false);
    define('WP_DEBUG_DISPLAY', false);

    // WordPress Cache and Performance
    define('WP_CACHE', true);
    define('COMPRESS_CSS', true);
    define('COMPRESS_SCRIPTS', true);
    define('ENFORCE_GZIP', true);

    // WordPress Security
    define('DISALLOW_FILE_EDIT', true);
    define('FORCE_SSL_ADMIN', false);  // SSL handled by ingress

    $table_prefix = 'wp_';

    if (!defined('ABSPATH')) {
        define('ABSPATH', __DIR__ . '/');
    }

    require_once ABSPATH . 'wp-settings.php';