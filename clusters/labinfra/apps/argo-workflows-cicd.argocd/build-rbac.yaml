---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: workflow-builder
  namespace: argocd

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: workflow-builder
rules:
# Access to ArgoCD applications for deployment triggers
- apiGroups: ["argoproj.io"]
  resources: ["applications"]
  verbs: ["get", "list", "patch", "update"]
# Access to secrets for registry authentication
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list"]
# Access to configmaps for build configuration
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list", "create", "update", "patch"]
# Access to workflows for pipeline management
- apiGroups: ["argoproj.io"]
  resources: ["workflows", "workflowruns"]
  verbs: ["create", "get", "list", "watch", "update", "patch", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: workflow-builder
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: workflow-builder
subjects:
- kind: ServiceAccount
  name: workflow-builder
  namespace: argocd